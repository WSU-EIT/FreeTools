# FreeTools.BrowserSnapshot — Screenshot Capture Tool

> **Purpose:** Captures full-page screenshots of all routes discovered by EndpointMapper using Playwright, enabling visual regression testing.  
> **Last Reviewed:** 2025-12-19  
> **Version:** 2.2

---

## Overview

The **BrowserSnapshot** tool is a development utility that:

- **Reads routes:** Loads routes from CSV generated by EndpointMapper
- **Captures screenshots:** Uses Playwright to render pages and capture full-page screenshots
- **Multiple browsers:** Supports Chromium, Firefox, and WebKit
- **Parallel execution:** Supports configurable thread count for fast capture
- **Auto-installs browsers:** Automatically downloads Playwright browsers on first run

---

## Technology Stack

| Technology | Version | Purpose |
|------------|---------|---------|
| .NET | 10.0 | Runtime framework |
| Microsoft.Playwright | 1.56.0 | Browser automation |

---

## Usage

### Via Aspire AppHost (Recommended)

The tool runs automatically when starting FreeTools.AppHost (waits for web app):

```bash
cd tools/FreeTools.AppHost
dotnet run
```

### Standalone

```bash
cd tools/FreeTools.BrowserSnapshot

# Run the tool (browsers auto-install on first run)
dotnet run [baseUrl] [csvPath] [outputDir] [maxThreads]
```

### Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `BASE_URL` | Base URL of the web app | `https://localhost:5001` |
| `CSV_PATH` | Path to pages.csv | `pages.csv` |
| `OUTPUT_DIR` | Directory for screenshot output | `page-snapshots` |
| `SCREENSHOT_BROWSER` | Browser to use (chromium/firefox/webkit) | `chromium` |
| `SCREENSHOT_VIEWPORT` | Viewport size (WIDTHxHEIGHT) | Playwright default |
| `MAX_THREADS` | Maximum parallel captures | `100` |

---

## Output Structure

Screenshots are saved alongside HTML files from EndpointPoker:

```
snapshots/
├── /
│   ├── default.html          # From EndpointPoker
│   └── default.png           # Screenshot
├── Settings/
│   ├── default.html
│   └── default.png
├── Schedule/
│   ├── default.html
│   └── default.png
└── Account/
    └── Login/
        ├── default.html
        └── default.png
```

---

## Integration

```
┌─────────────────────────────────────────────────────────────────┐
│                      FreeTools Pipeline                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. EndpointMapper     2. EndpointPoker    3. BrowserSnapshot   │
│  ┌────────────┐        ┌────────────┐      ┌────────────────┐   │
│  │ Scan .razor│───────►│ HTTP GET   │      │ Playwright     │   │
│  │ files      │        │ each route │      │ screenshots    │   │
│  └────────────┘        └────────────┘      └────────────────┘   │
│        │                     │                    │             │
│        ▼                     ▼                    ▼             │
│   pages.csv            *.html files          *.png files        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Browser Installation

Playwright browsers are **automatically installed** on first run. 

For manual installation:

```bash
# PowerShell (Windows)
pwsh bin/Debug/net10.0/playwright.ps1 install chromium

# Or install all browsers
pwsh bin/Debug/net10.0/playwright.ps1 install
```

---

*Part of the FreeTools suite*
